{% extends 'main.html' %}
{% load mptt_tags %}
{% load static %}
{% load rating_tags %}
{% load thumbnail %}

{% block title %}{{ post.title }}{% endblock %} {# –î–æ–±–∞–≤–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã #}

{% block content %}
    <div class="card mb-3">
        {# –ë–ª–æ–∫ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è #}
        <div class="row g-0 justify-content-center"> {# –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ #}
            <div class="col-md-8"> {# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 2/3 —à–∏—Ä–∏–Ω—ã #}
                {% if post.thumbnail and post.thumbnail.name != 'images/thumbnails/default.jpg' %}
                    <img src="{% thumbnail post.thumbnail "800x600" crop="center" quality=85 %}" {# –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä –¥–ª—è 2/3 —à–∏—Ä–∏–Ω—ã #}
                         class="img-fluid rounded-top d-block mx-auto mt-3" {# d-block mx-auto –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è #}
                         alt="{{ post.title }}">
                {% else %}
                    <img src="{% static 'images/thumbnails/default.jpg' %}"
                         class="img-fluid rounded-top d-block mx-auto mt-3"
                         alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ">
                {% endif %}
            </div>
        </div>

        {# –ë–ª–æ–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞ #}
        <div class="card-body">
            <h5 class="card-title">{{ post.title }}</h5>
            <p class="card-text text-muted">
                <small>
                    –ö–∞—Ç–µ–≥–æ—Ä–∏—è: <a href="{% url 'blog:post_by_category' post.category.slug %}">{{ post.category.title }}</a>
                    / –î–æ–±–∞–≤–∏–ª: <a href="{% url 'accounts:profile_detail' post.author.profile.slug %}">{{ post.author.username }}</a>
                    / <time>{{ post.create|date:"d.m.Y H:i" }}</time> {# –ò—Å–ø–æ–ª—å–∑—É–µ–º post.create, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –ø–æ–ª–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è #}
                    {% if post.updater %} {# –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±–Ω–æ–≤–∏–≤—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #}
                        / –û–±–Ω–æ–≤–ª–µ–Ω–æ: <a href="{% url 'accounts:profile_detail' post.updater.profile.slug %}">{{ post.updater.username }}</a>
                        <time>{{ post.update|date:"d.m.Y H:i" }}</time>
                    {% endif %}
                </small>
            </p>
            
            <p class="card-text lead">{{ post.description }}</p> {# –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫—Ä—É–ø–Ω–µ–µ #}
            <hr> {# –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º #}
            <div class="post-text"> {# –û–±–µ—Ä–Ω–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ #}
                {{ post.text|linebreaksbr }}
            </div>
        </div>

        {# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ –Ω–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫ #}
        <div class="card-footer d-flex justify-content-between align-items-center">
            {# –ë–ª–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ (—Å–ª–µ–≤–∞) #}
            <div class="rating-buttons" data-post-id="{{ post.id }}">
                {% get_user_rating_value post request.user as current_vote %}

                <button class="btn btn-sm {% if current_vote == 1 %}btn-success{% else %}btn-outline-success{% endif %} like-button" data-value="1"
                        data-current-vote="{{ current_vote }}">
                    üëç
                </button>
                <button class="btn btn-sm {% if current_vote == -1 %}btn-danger{% else %}btn-outline-danger{% endif %} dislike-button" data-value="-1"
                        data-current-vote="{{ current_vote }}">
                    üëé
                </button>
                <span class="rating-sum badge bg-secondary ms-2">{{ post.get_sum_rating }}</span>
            </div>

            {# –ë–ª–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –∏ "–ù–∞ –≥–ª–∞–≤–Ω—É—é" (—Å–ø—Ä–∞–≤–∞) #}
            <div class="action-buttons">
                {% if request.user.is_authenticated and request.user == post.author or request.user.is_staff or request.user.is_superuser %}
                    <a href="{% url 'blog:post_update' post.slug %}" class="btn btn-warning btn-sm me-2">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                {% endif %}
                <a href="{% url 'blog:home' %}" class="btn btn-info btn-sm">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            </div>
        </div>
    </div>

    <div class="card border-0 mt-4">
        <div class="card-body">
            <h5 class="card-title">
                –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            </h5>
            {% include 'blog/comments/comments_list.html' %}
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    {# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ –±–ª–æ–∫–µ extra_js #}
    <script src="{% static 'js/ratings.js' %}"></script>
{% endblock %}